---
name: 데이터베이스 설계 및 마이그레이션
status: done
created: 2025-12-03T13:45:12Z
updated: 2025-12-04T00:20:00Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task: 데이터베이스 설계 및 마이그레이션

## Description

전체 데이터베이스 스키마를 설계하고 Laravel 마이그레이션을 생성합니다. Eloquent 모델과 관계를 정의하고, 개발용 시더를 작성합니다.

## Acceptance Criteria

- [x] 모든 테이블 마이그레이션 파일 생성
- [x] Eloquent 모델 생성 및 관계 정의
- [x] 개발용 Factory 및 Seeder 작성
- [x] `php artisan migrate:fresh --seed` 정상 동작
- [x] 외래 키 제약 조건 정상 동작

## Technical Details

### 마이그레이션 파일 목록

```
database/migrations/
├── create_users_table.php (수정)
├── create_social_accounts_table.php
├── create_vendors_table.php
├── create_products_table.php
├── create_product_translations_table.php
├── create_product_prices_table.php
├── create_product_images_table.php
├── create_product_schedules_table.php
├── create_bookings_table.php
├── create_booking_options_table.php
├── create_reviews_table.php
├── create_review_images_table.php
├── create_messages_table.php
├── create_wishlists_table.php
├── create_reports_table.php
└── create_permission_tables.php (spatie)
```

### 모델 관계

```php
// User
- hasOne: Vendor
- hasMany: Bookings, Reviews, Messages, Wishlists
- belongsToMany: Roles (spatie)

// Product
- belongsTo: Vendor
- hasMany: Translations, Prices, Images, Schedules, Bookings, Reviews
- belongsToMany: Wishlists (through users)

// Booking
- belongsTo: Product, User, Guide (User), Schedule
- hasMany: Options, Messages
- hasOne: Review

// Review
- belongsTo: Booking, User
- hasMany: Images
```

### 주요 Enum 값

```php
// User roles
enum UserRole: string {
    case TRAVELER = 'traveler';
    case VENDOR = 'vendor';
    case GUIDE = 'guide';
    case ADMIN = 'admin';
}

// Product types
enum ProductType: string {
    case DAY_TOUR = 'day_tour';
    case PACKAGE = 'package';
    case ACTIVITY = 'activity';
}

// Booking status
enum BookingStatus: string {
    case PENDING = 'pending';
    case CONFIRMED = 'confirmed';
    case CANCELLED = 'cancelled';
    case COMPLETED = 'completed';
    case NO_SHOW = 'no_show';
}

// Booking type
enum BookingType: string {
    case INSTANT = 'instant';
    case REQUEST = 'request';
}
```

### Seeder 데이터

- Admin 계정 1개
- Vendor 계정 3개
- Guide 계정 5개
- Traveler 계정 10개
- 상품 20개 (다국어 포함)
- 예약 50개

## Dependencies

- [ ] Task 001 완료 (프로젝트 초기 설정)
- [ ] spatie/laravel-permission 설치됨

## Effort Estimate

- Size: M
- Complexity: Medium
- Parallel: false (다른 태스크의 기반)

## Definition of Done

- [x] 모든 마이그레이션 파일 생성 완료
- [x] `php artisan migrate:fresh` 오류 없이 실행
- [x] 모든 Eloquent 모델 생성 완료
- [x] 모델 관계 테스트 (tinker로 확인)
- [x] Seeder 실행 후 샘플 데이터 확인
- [ ] ERD 문서 작성 (선택)

## Completion Notes

- **완료일**: 2025-12-03
- **주요 구현**:
  - 15개 마이그레이션 파일 생성
  - 11개 Eloquent 모델 및 관계 정의
  - 8개 Enum 클래스 (UserRole, ProductType, ProductStatus, BookingType, BookingStatus, Language, Region, VendorStatus)
  - Factory 및 Seeder 작성
  - Unit 테스트 작성 (모델 테스트)