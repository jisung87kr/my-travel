---
name: 상품 관리 시스템
status: open
created: 2025-12-03T13:45:12Z
updated: 2025-12-03T13:45:12Z
github: [Will be updated when synced to GitHub]
depends_on: [002, 003]
parallel: true
conflicts_with: []
---

# Task: 상품 관리 시스템

## Description

관광 상품의 CRUD 기능을 구현합니다. 다국어 지원(한/영/중/일), 이미지 업로드, 가격 옵션 관리, 검색 및 필터링 기능을 포함합니다.

## Acceptance Criteria

- [ ] 상품 생성 (3가지 유형: 당일/숙박/체험)
- [ ] 상품 조회 (목록/상세)
- [ ] 상품 수정
- [ ] 상품 삭제 (soft delete)
- [ ] 다국어 상품 정보 입력/조회
- [ ] 이미지 다중 업로드 및 순서 관리
- [ ] 가격 옵션 관리 (성인/아동/추가옵션)
- [ ] 지역별, 유형별, 날짜별 필터링
- [ ] 키워드 검색

## Technical Details

### 컨트롤러 구조

```
app/Http/Controllers/
├── ProductController.php           # 공개 상품 조회 (관광객용)
└── Vendor/
    └── ProductController.php       # 제공자 상품 관리
```

### 서비스 레이어

```php
// app/Services/ProductService.php
class ProductService
{
    public function create(array $data, User $vendor): Product;
    public function update(Product $product, array $data): Product;
    public function delete(Product $product): bool;
    public function uploadImages(Product $product, array $files): void;
    public function reorderImages(Product $product, array $order): void;
    public function search(array $filters): LengthAwarePaginator;
}
```

### API 엔드포인트

```php
// 공개 API (관광객용)
Route::get('/products', [ProductController::class, 'index']);
Route::get('/products/{product}', [ProductController::class, 'show']);

// 제공자 API
Route::middleware(['auth', 'role:vendor'])->prefix('vendor')->group(function () {
    Route::get('/products', [Vendor\ProductController::class, 'index']);
    Route::post('/products', [Vendor\ProductController::class, 'store']);
    Route::get('/products/{product}', [Vendor\ProductController::class, 'show']);
    Route::put('/products/{product}', [Vendor\ProductController::class, 'update']);
    Route::delete('/products/{product}', [Vendor\ProductController::class, 'destroy']);
    Route::post('/products/{product}/images', [Vendor\ProductController::class, 'uploadImages']);
    Route::put('/products/{product}/images/reorder', [Vendor\ProductController::class, 'reorderImages']);
    Route::delete('/products/{product}/images/{image}', [Vendor\ProductController::class, 'deleteImage']);
});
```

### 다국어 처리

```php
// app/Models/Product.php
public function translations(): HasMany
{
    return $this->hasMany(ProductTranslation::class);
}

public function getTranslation(string $locale = null): ?ProductTranslation
{
    $locale = $locale ?? app()->getLocale();
    return $this->translations->firstWhere('locale', $locale)
        ?? $this->translations->firstWhere('locale', 'ko');
}

// 사용 예시
$product->getTranslation('en')->name;
$product->getTranslation('en')->description;
```

### 필터링 쿼리

```php
// app/Http/Controllers/ProductController.php
public function index(Request $request)
{
    $query = Product::query()
        ->with(['translations', 'prices', 'images', 'vendor'])
        ->where('status', 'active');

    // 지역 필터
    if ($request->region) {
        $query->where('region', $request->region);
    }

    // 유형 필터
    if ($request->type) {
        $query->where('type', $request->type);
    }

    // 날짜 필터 (해당 날짜에 재고 있는 상품)
    if ($request->date) {
        $query->whereHas('schedules', function ($q) use ($request) {
            $q->where('date', $request->date)
              ->where('available_count', '>', 0)
              ->where('is_active', true);
        });
    }

    // 키워드 검색 (다국어)
    if ($request->keyword) {
        $query->whereHas('translations', function ($q) use ($request) {
            $q->where('name', 'like', "%{$request->keyword}%")
              ->orWhere('description', 'like', "%{$request->keyword}%");
        });
    }

    return $query->paginate(20);
}
```

### Form Request Validation

```php
// app/Http/Requests/StoreProductRequest.php
public function rules(): array
{
    return [
        'type' => 'required|in:day_tour,package,activity',
        'region' => 'required|string|max:100',
        'duration' => 'required|integer|min:1',
        'min_persons' => 'required|integer|min:1',
        'max_persons' => 'required|integer|gte:min_persons',
        'booking_type' => 'required|in:instant,request',

        // 다국어 필드
        'translations' => 'required|array|min:1',
        'translations.*.locale' => 'required|in:ko,en,zh,ja',
        'translations.*.name' => 'required|string|max:200',
        'translations.*.description' => 'required|string',
        'translations.*.includes' => 'nullable|string',
        'translations.*.excludes' => 'nullable|string',
        'translations.*.notes' => 'nullable|string',

        // 가격
        'prices' => 'required|array|min:1',
        'prices.*.type' => 'required|in:adult,child,option',
        'prices.*.label' => 'nullable|string|max:100',
        'prices.*.amount' => 'required|numeric|min:0',

        // 이미지
        'images' => 'nullable|array',
        'images.*' => 'image|max:5120', // 5MB
    ];
}
```

## Dependencies

- [ ] Task 002 완료 (Product 모델 및 관련 테이블)
- [ ] Task 003 완료 (인증, 역할 기반 접근 제어)
- [ ] intervention/image 패키지 설치됨

## Effort Estimate

- Size: L
- Complexity: High
- Parallel: true (Task 005와 병렬 가능, 단 모델 충돌 주의)

## Definition of Done

- [ ] 제공자가 상품 CRUD 모두 가능
- [ ] 4개 언어 다국어 입력/조회 정상 동작
- [ ] 이미지 업로드 및 리사이징 동작
- [ ] 필터링 및 검색 정상 동작
- [ ] API 응답 포맷 일관성 확인
- [ ] Feature Test 작성 (ProductTest.php)