---
name: 인증 시스템 구현
status: open
created: 2025-12-03T13:45:12Z
updated: 2025-12-03T13:45:12Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 002]
parallel: false
conflicts_with: []
---

# Task: 인증 시스템 구현

## Description

Laravel Sanctum 기반의 세션 인증과 Socialite를 활용한 소셜 로그인(Google, Kakao, Apple)을 구현합니다. spatie/laravel-permission을 사용하여 역할 기반 접근 제어(RBAC)를 설정합니다.

## Acceptance Criteria

- [ ] 이메일/비밀번호 회원가입 동작
- [ ] 이메일/비밀번호 로그인 동작
- [ ] 비밀번호 찾기/재설정 동작
- [ ] Google 소셜 로그인 동작
- [ ] Kakao 소셜 로그인 동작
- [ ] Apple 소셜 로그인 동작
- [ ] 역할(traveler, vendor, guide, admin) 할당 동작
- [ ] 역할별 라우트 보호 미들웨어 동작
- [ ] 로그아웃 동작

## Technical Details

### 컨트롤러 구조

```
app/Http/Controllers/Auth/
├── RegisterController.php
├── LoginController.php
├── LogoutController.php
├── ForgotPasswordController.php
├── ResetPasswordController.php
└── SocialLoginController.php
```

### 라우트

```php
// routes/web.php
Route::middleware('guest')->group(function () {
    Route::get('/register', [RegisterController::class, 'showForm']);
    Route::post('/register', [RegisterController::class, 'register']);
    Route::get('/login', [LoginController::class, 'showForm'])->name('login');
    Route::post('/login', [LoginController::class, 'login']);

    // Social Login
    Route::get('/auth/{provider}/redirect', [SocialLoginController::class, 'redirect']);
    Route::get('/auth/{provider}/callback', [SocialLoginController::class, 'callback']);

    // Password Reset
    Route::get('/forgot-password', [ForgotPasswordController::class, 'showForm']);
    Route::post('/forgot-password', [ForgotPasswordController::class, 'sendLink']);
    Route::get('/reset-password/{token}', [ResetPasswordController::class, 'showForm']);
    Route::post('/reset-password', [ResetPasswordController::class, 'reset']);
});

Route::middleware('auth')->group(function () {
    Route::post('/logout', [LogoutController::class, 'logout']);
});
```

### 미들웨어

```php
// app/Http/Middleware/CheckRole.php
public function handle($request, Closure $next, ...$roles)
{
    if (!$request->user() || !$request->user()->hasAnyRole($roles)) {
        abort(403, 'Unauthorized');
    }
    return $next($request);
}

// 사용 예시
Route::middleware(['auth', 'role:vendor'])->prefix('vendor')->group(...);
Route::middleware(['auth', 'role:admin'])->prefix('admin')->group(...);
```

### 소셜 로그인 설정

```php
// config/services.php
'google' => [
    'client_id' => env('GOOGLE_CLIENT_ID'),
    'client_secret' => env('GOOGLE_CLIENT_SECRET'),
    'redirect' => env('GOOGLE_REDIRECT_URI'),
],
'kakao' => [
    'client_id' => env('KAKAO_CLIENT_ID'),
    'client_secret' => env('KAKAO_CLIENT_SECRET'),
    'redirect' => env('KAKAO_REDIRECT_URI'),
],
'apple' => [
    'client_id' => env('APPLE_CLIENT_ID'),
    'client_secret' => env('APPLE_CLIENT_SECRET'),
    'redirect' => env('APPLE_REDIRECT_URI'),
],
```

### Roles & Permissions 초기화

```php
// database/seeders/RoleSeeder.php
Role::create(['name' => 'traveler']);
Role::create(['name' => 'vendor']);
Role::create(['name' => 'guide']);
Role::create(['name' => 'admin']);

// Permissions (optional)
Permission::create(['name' => 'manage products']);
Permission::create(['name' => 'manage bookings']);
Permission::create(['name' => 'manage users']);
```

### 뷰 파일

```
resources/views/auth/
├── register.blade.php
├── login.blade.php
├── forgot-password.blade.php
└── reset-password.blade.php
```

## Dependencies

- [ ] Task 001 완료 (Sanctum, Socialite 설치)
- [ ] Task 002 완료 (User 모델, social_accounts 테이블)
- [ ] Google OAuth 앱 생성 및 credentials 확보
- [ ] Kakao OAuth 앱 생성 및 credentials 확보
- [ ] Apple OAuth 앱 생성 및 credentials 확보

## Effort Estimate

- Size: M
- Complexity: Medium (Apple 로그인이 가장 복잡)
- Parallel: false (다른 기능의 기반)

## Definition of Done

- [ ] 회원가입 폼에서 계정 생성 확인
- [ ] 로그인 후 세션 유지 확인
- [ ] 소셜 로그인 3종 모두 테스트 통과
- [ ] 역할별 라우트 접근 제한 테스트
- [ ] 비밀번호 재설정 이메일 발송 확인
- [ ] Feature Test 작성 (AuthTest.php)